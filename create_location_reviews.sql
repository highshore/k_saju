-- location_reviews 테이블 생성 및 샘플 데이터 삽입

-- location_reviews 테이블 생성
CREATE TABLE IF NOT EXISTS location_reviews (
  id SERIAL PRIMARY KEY,
  location_id INTEGER REFERENCES locations(id) ON DELETE CASCADE,
  name VARCHAR(100) NOT NULL,
  date DATE NOT NULL,
  rating INTEGER CHECK (rating >= 1 AND rating <= 5),
  text TEXT NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 인덱스 생성
CREATE INDEX IF NOT EXISTS idx_location_reviews_location_id ON location_reviews(location_id);
CREATE INDEX IF NOT EXISTS idx_location_reviews_rating ON location_reviews(rating);

-- 각 location에 대한 샘플 리뷰 데이터 삽입
INSERT INTO location_reviews (location_id, name, date, rating, text) VALUES
-- Location 1의 리뷰들
(1, '김사주', '2024-01-15', 5, '정말 정확한 분석이었습니다. AI가 이렇게 정밀할 줄 몰랐어요!'),
(1, '이운세', '2024-01-10', 5, '친구 추천으로 받았는데 정말 만족스럽습니다. 상세한 설명도 좋고요.'),
(1, '박점술', '2024-01-08', 4, '가격 대비 품질이 좋습니다. 다음에도 이용하고 싶어요.'),
(1, '최명리', '2024-01-05', 5, '전문적이고 상세한 분석이 인상적이었습니다. 추천합니다!'),
(1, '정사주', '2024-01-03', 4, 'AI 분석이 정말 정확해서 놀랐어요. 다음에도 꼭 이용할 예정입니다.'),

-- Location 2의 리뷰들
(2, '한운세', '2024-01-01', 5, '친절한 상담과 정확한 분석으로 만족스러운 경험이었습니다.'),
(2, '오점술', '2023-12-28', 4, '가격 대비 품질이 우수합니다. 주변 지인들에게도 추천했어요.'),
(2, '윤사주', '2023-12-25', 5, 'AI 기술과 전통 사주학의 만남이 정말 인상적이었습니다.'),
(2, '강명리', '2023-12-22', 4, '상세한 리포트와 친절한 설명이 좋았습니다. 만족해요!'),
(2, '임운세', '2023-12-20', 5, '정확한 분석과 실용적인 조언이 도움이 많이 되었습니다.'),

-- Location 3의 리뷰들
(3, '조사주', '2023-12-18', 4, 'AI 분석이 정말 놀라웠습니다. 전통 사주와의 조화가 인상적이에요.'),
(3, '신명리', '2023-12-15', 5, '친절한 상담과 정확한 분석으로 만족스러운 경험이었습니다.'),
(3, '백운세', '2023-12-12', 4, '가격 대비 품질이 우수합니다. 주변 지인들에게도 추천했어요.'),
(3, '송점술', '2023-12-10', 5, '상세한 리포트와 친절한 설명이 좋았습니다. 만족해요!'),
(3, '허사주', '2023-12-08', 4, 'AI 기술과 전통 사주학의 만남이 정말 인상적이었습니다.'),

-- 나머지 location들에 대한 리뷰 (패턴으로 생성)
(4, '김철수', '2024-01-14', 5, '정말 만족스러운 서비스였습니다. 추천합니다!'),
(4, '이영희', '2024-01-12', 4, 'AI 분석이 정확해서 놀랐어요. 다음에도 이용할 예정입니다.'),
(4, '박민수', '2024-01-10', 5, '친절한 상담과 정확한 분석으로 만족스러운 경험이었습니다.'),

(5, '최지영', '2024-01-13', 5, '프리미엄 서비스답게 정말 좋았습니다.'),
(5, '정현우', '2024-01-11', 4, '가격은 조금 비싸지만 품질이 우수합니다.'),
(5, '한소영', '2024-01-09', 5, 'VIP 상담이라 그런지 정말 만족스러웠어요.'),

-- 6-30번 location들에 대한 리뷰 생성
(6, '김민지', '2024-01-08', 4, '빠른 AI 분석이 인상적이었습니다.'),
(6, '이준호', '2024-01-06', 5, '모바일로도 편리하게 이용할 수 있어서 좋았어요.'),
(6, '박서연', '2024-01-04', 4, '데이터 기반 분석이 정확했습니다.'),

(7, '최동현', '2024-01-07', 5, '전통 명리학 기반의 깊이 있는 분석이 좋았습니다.'),
(7, '정유진', '2024-01-05', 4, '전문가의 상담이 정말 도움이 되었어요.'),
(7, '한승우', '2024-01-03', 5, '전통 기법이 현대적으로 잘 적용되었습니다.'),

-- 8-30번 location들에 대한 리뷰 (자동 생성)
(8, '김하늘', '2024-01-06', 4, '정확한 분석이었습니다.'),
(8, '이별', '2024-01-04', 5, '만족스러운 서비스였어요.'),
(8, '박달', '2024-01-02', 4, '좋은 경험이었습니다.'),

(9, '최은하', '2024-01-05', 5, '추천합니다!'),
(9, '정별', '2024-01-03', 4, '좋았어요.'),
(9, '한달', '2024-01-01', 5, '만족합니다.'),

(10, '김별', '2024-01-04', 4, '괜찮았습니다.'),
(10, '이하늘', '2024-01-02', 5, '좋았어요.'),
(10, '박은하', '2024-01-01', 4, '만족스러웠습니다.'),

-- 11-30번 location들에 대한 리뷰 (패턴 반복)
(11, '최별', '2024-01-03', 5, '정말 좋았습니다.'),
(11, '정하늘', '2024-01-01', 4, '만족해요.'),
(11, '한은하', '2023-12-31', 5, '추천합니다.'),

(12, '김달', '2024-01-02', 4, '좋은 서비스였어요.'),
(12, '이별', '2023-12-30', 5, '만족스러웠습니다.'),
(12, '박하늘', '2023-12-28', 4, '괜찮았어요.'),

-- 13-30번 location들에 대한 리뷰 (계속 패턴)
(13, '최은하', '2024-01-01', 5, '정말 좋았습니다.'),
(13, '정별', '2023-12-29', 4, '만족해요.'),
(13, '한달', '2023-12-27', 5, '추천합니다.'),

(14, '김하늘', '2023-12-31', 4, '좋은 서비스였어요.'),
(14, '이은하', '2023-12-29', 5, '만족스러웠습니다.'),
(14, '박별', '2023-12-27', 4, '괜찮았어요.'),

(15, '최달', '2023-12-30', 5, '정말 좋았습니다.'),
(15, '정하늘', '2023-12-28', 4, '만족해요.'),
(15, '한은하', '2023-12-26', 5, '추천합니다.'),

-- 16-30번 location들에 대한 리뷰 (마지막 패턴)
(16, '김별', '2023-12-29', 4, '좋은 서비스였어요.'),
(16, '이달', '2023-12-27', 5, '만족스러웠습니다.'),
(16, '박하늘', '2023-12-25', 4, '괜찮았어요.'),

(17, '최은하', '2023-12-28', 5, '정말 좋았습니다.'),
(17, '정별', '2023-12-26', 4, '만족해요.'),
(17, '한달', '2023-12-24', 5, '추천합니다.'),

(18, '김하늘', '2023-12-27', 4, '좋은 서비스였어요.'),
(18, '이은하', '2023-12-25', 5, '만족스러웠습니다.'),
(18, '박별', '2023-12-23', 4, '괜찮았어요.'),

(19, '최달', '2023-12-26', 5, '정말 좋았습니다.'),
(19, '정하늘', '2023-12-24', 4, '만족해요.'),
(19, '한은하', '2023-12-22', 5, '추천합니다.'),

(20, '김별', '2023-12-25', 4, '좋은 서비스였어요.'),
(20, '이달', '2023-12-23', 5, '만족스러웠습니다.'),
(20, '박하늘', '2023-12-21', 4, '괜찮았어요.'),

(21, '최은하', '2023-12-24', 5, '정말 좋았습니다.'),
(21, '정별', '2023-12-22', 4, '만족해요.'),
(21, '한달', '2023-12-20', 5, '추천합니다.'),

(22, '김하늘', '2023-12-23', 4, '좋은 서비스였어요.'),
(22, '이은하', '2023-12-21', 5, '만족스러웠습니다.'),
(22, '박별', '2023-12-19', 4, '괜찮았어요.'),

(23, '최달', '2023-12-22', 5, '정말 좋았습니다.'),
(23, '정하늘', '2023-12-20', 4, '만족해요.'),
(23, '한은하', '2023-12-18', 5, '추천합니다.'),

(24, '김별', '2023-12-21', 4, '좋은 서비스였어요.'),
(24, '이달', '2023-12-19', 5, '만족스러웠습니다.'),
(24, '박하늘', '2023-12-17', 4, '괜찮았어요.'),

(25, '최은하', '2023-12-20', 5, '정말 좋았습니다.'),
(25, '정별', '2023-12-18', 4, '만족해요.'),
(25, '한달', '2023-12-16', 5, '추천합니다.'),

(26, '김하늘', '2023-12-19', 4, '좋은 서비스였어요.'),
(26, '이은하', '2023-12-17', 5, '만족스러웠습니다.'),
(26, '박별', '2023-12-15', 4, '괜찮았어요.'),

(27, '최달', '2023-12-18', 5, '정말 좋았습니다.'),
(27, '정하늘', '2023-12-16', 4, '만족해요.'),
(27, '한은하', '2023-12-14', 5, '추천합니다.'),

(28, '김별', '2023-12-17', 4, '좋은 서비스였어요.'),
(28, '이달', '2023-12-15', 5, '만족스러웠습니다.'),
(28, '박하늘', '2023-12-13', 4, '괜찮았어요.'),

(29, '최은하', '2023-12-16', 5, '정말 좋았습니다.'),
(29, '정별', '2023-12-14', 4, '만족해요.'),
(29, '한달', '2023-12-12', 5, '추천합니다.'),

(30, '김하늘', '2023-12-15', 4, '좋은 서비스였어요.'),
(30, '이은하', '2023-12-13', 5, '만족스러웠습니다.'),
(30, '박별', '2023-12-11', 4, '괜찮았어요.');

-- locations 테이블의 review_count 업데이트
UPDATE locations SET 
  review_count = (
    SELECT COUNT(*) 
    FROM location_reviews 
    WHERE location_reviews.location_id = locations.id
  );

-- locations 테이블의 rating 업데이트 (평균 평점)
UPDATE locations SET 
  rating = (
    SELECT ROUND(AVG(rating::numeric), 1)
    FROM location_reviews 
    WHERE location_reviews.location_id = locations.id
  );


